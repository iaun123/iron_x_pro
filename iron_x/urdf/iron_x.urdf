<?xml version="1.0" encoding="utf-8"?>
<robot name="iron_x" xmlns:xacro="http://ros.org/wiki/xacro">
  
<!-- color -->
  <material name="dark">
    <color rgba="0.1 0.1 0.1 1.0" />
  </material>
  <material name="grey">
    <color rgba="0.5 0.5 0.5 1.0" />
  </material>
  <material name="blue">
    <color rgba="0.0 0.0 0.8 1.0" />
  </material>
  <material name="white">
    <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
  </material>
  <material name="red">
    <color rgba="1 0 0 1" />
  </material>

<!-- Define intertial property macros  -->
  <xacro:macro name="box_inertia" params="m w h d">
    <inertial>
      <origin xyz="0 0 0" rpy="${pi/2} 0 ${pi/2}"/>
      <mass value="${m}"/>
      <inertia ixx="${(m/12) * (h*h + d*d)}" ixy="0.0" ixz="0.0" iyy="${(m/12) * (w*w + d*d)}" iyz="0.0" izz="${(m/12) * (w*w + h*h)}"/>
    </inertial>
  </xacro:macro>

<!-- base link -->
  <link name="base_link">
    <inertial>
      <origin xyz="0.00868847650405078 -0.000257115100040666 -0.00100383255756042" rpy="0 0 0" />
      <mass value="1"/>
      <inertia
        ixx="0.000281554923820775"
        ixy="-4.47037724008487E-09"
        ixz="-1.2708786782725E-08"
        iyy="0.000902471808953337"
        iyz="-1.44937525962296E-07"
        izz="0.00114409887764575" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/base_link.STL" />
      </geometry>
      <material name="white" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>

  <gazebo reference="base_link">
    <material>Gazebo/White</material>
  </gazebo>

<!-- base_footprint -->
  <link name="base_footprint">
  	<xacro:box_inertia m="0" w="0" d="0" h="0"/>
  </link>

  <joint name="base_joint" type="fixed">
    <parent link="base_link"/>
    <child link="base_footprint"/>
    <origin xyz="0.0 0.0 -0.1" rpy="0 0 0"/>
  </joint>

<!-- lf -->
  <link name="left_front_link">
    <inertial>
      <origin xyz="1.91651541997517E-08 -1.91454755868459E-09 3.54674939309213E-05" rpy="0 0 0" />
      <mass value="0.218196881966572" />
      <inertia
        ixx="6.03098003991985E-05"
        ixy="5.46342620592672E-11"
        ixz="2.12557030727322E-11"
        iyy="6.03113932361835E-05"
        iyz="6.32278514410869E-11"
        izz="6.91134863510834E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Left_front_main_link.STL" />
      </geometry>
      <material name="dark" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Left_front_main_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="left_front_joint" type="continuous">
    <origin xyz="0.075 0.093 -0.0165" rpy="-1.5708 0 0" />
    <parent link="base_link" />
    <child link="left_front_link" />
    <axis xyz="0 0 1" />
    <limit effort="10" velocity="10" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>

  <gazebo reference="left_front_link">
    <material>Gazebo/Black</material>
  </gazebo>

<!-- rf -->
  <link name="right_front_link">
    <inertial>
      <origin xyz="4.46523888003592E-08 -6.75413587385154E-08 -0.000212318386699786" rpy="0 0 0" />
      <mass value="0.217950760055372" />
      <inertia
        ixx="6.00995748625438E-05"
        ixy="-7.83278277928891E-11"
        ixz="-2.69815527512961E-11"
        iyy="6.0100935771305E-05"
        iyz="1.81167950824226E-11"
        izz="6.86941143604206E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Right_front_main_link.STL" />
      </geometry>
      <material name="dark" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Right_front_main_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="right_front_joint" type="continuous">
    <origin xyz="0.075 -0.093002 -0.0165" rpy="1.5708 0 0" />
    <parent link="base_link" />
    <child link="right_front_link" />
    <axis xyz="0 0 -1" />
    <limit effort="10" velocity="10" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>

  <gazebo reference="right_front_link">
    <material>Gazebo/Black</material>
  </gazebo>

<!-- rb -->
  <link name="right_back_link">
    <inertial>
      <origin xyz="-3.36449804266836E-08 1.08012634635057E-08 -3.55185643661077E-05" rpy="0 0 0" />
      <mass value="0.218196600372531" />
      <inertia
        ixx="6.03096002691482E-05"
        ixy="2.39952561726302E-12"
        ixz="3.49640917533502E-13"
        iyy="6.0311444302531E-05"
        iyz="1.18459960092786E-10"
        izz="6.91133917321441E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Right_back_main_link.STL" />
      </geometry>
      <material name="dark" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Right_back_main_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="right_back_joint" type="continuous">
    <origin xyz="-0.075 -0.093 -0.0165" rpy="1.5708 0 0" />
    <parent link="base_link" />
    <child link="right_back_link" />
    <axis xyz="0 0 -1" />
    <limit effort="10" velocity="10" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>

  <gazebo reference="right_back_link">
    <material>Gazebo/Black</material>
  </gazebo>

<!-- lb -->
  <link name="left_back_link">
    <inertial>
      <origin xyz="1.25928190736202E-07 9.02516253536989E-08 0.000212252459011103" rpy="0 0 0" />
      <mass value="0.217951478604634" />
      <inertia
        ixx="6.00998665627385E-05"
        ixy="-1.35668841049303E-10"
        ixz="2.20302791321124E-11"
        iyy="6.01010944337809E-05"
        iyz="-7.72858410492777E-11"
        izz="6.86943038179532E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Left_back_main_link.STL" />
      </geometry>
      <material name="dark" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Left_back_main_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="left_back_joint" type="continuous">
    <origin xyz="-0.075 0.093002 -0.0165" rpy="-1.5708 0 0" />
    <parent link="base_link" />
    <child link="left_back_link" />
    <axis xyz="0 0 1" />
    <limit effort="10" velocity="10" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>

  <gazebo reference="left_back_link">
    <material>Gazebo/Black</material>
  </gazebo>

<!-- joint_state -->
  <gazebo>
    <plugin name="gazebo_joint_state" filename="libgazebo_ros_joint_state_publisher.so">
      <update_rate>20</update_rate>
      <joint_name>left_front_joint</joint_name>
      <joint_name>right_front_joint</joint_name>
      <joint_name>left_back_joint</joint_name>
      <joint_name>right_back_joint</joint_name>
    </plugin>
  </gazebo>

<!-- camera -->
  <link name="camera_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Realsense_link.STL" />
      </geometry>
      <material name="white" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/Realsense_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="camera_joint" type="fixed">
    <origin xyz="0.125 -0.00024252 0.054467" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="camera_link" />
  </joint>

  <!-- <link name="camera_depth_frame"/>
  <joint name="camera_depth_joint" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <parent link="camera_link"/>
    <child link="camera_depth_frame"/>
  </joint> -->

  <link name="camera_rgb_frame"/>
  <joint name="camera_rgb_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/>
    <parent link="camera_link"/>
    <child link="camera_rgb_frame"/>
  </joint>
  
  <link name="camera_rgb_optical_frame"/>
  <joint name="camera_rgb_optical_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/>
    <parent link="camera_rgb_frame"/>
    <child link="camera_rgb_optical_frame"/>
  </joint>
  
  <!-- <link name="camera_depth_optical_frame"/>
  <joint name="camera_depth_optical_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/>
    <parent link="camera_depth_frame"/>
    <child link="camera_depth_optical_frame"/>
  </joint> -->
  
  <gazebo reference="camera_link">
    <material>Gazebo/White</material>
  </gazebo>

  <gazebo reference="camera_link">
    <sensor name="camera" type="depth">
      <always_on>true</always_on>
      <visualize>true</visualize>
      <update_rate>20.0</update_rate>
      <camera name="intel_realsense">
        <horizontal_fov>0.55</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.2</near>
          <far>5</far>
        </clip>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.007</stddev>
        </noise>
      </camera>
      <plugin name="depth_camera_controller" filename="libgazebo_ros_camera.so">
        <baseline>0.2</baseline>
        <alwaysOn>true</alwaysOn>
        <updateRate>20.0</updateRate>
        <frame_name>camera_rgb_frame</frame_name>
        <pointCloudCutoff>0.5</pointCloudCutoff>
        <pointCloudCutoffMax>3.0</pointCloudCutoffMax>
        <distortionK1>0</distortionK1>
        <distortionK2>0</distortionK2>
        <distortionK3>0</distortionK3>
        <distortionT1>0</distortionT1>
        <distortionT2>0</distortionT2>
        <CxPrime>0</CxPrime>
        <Cx>0</Cx>
        <Cy>0</Cy>
        <focalLength>0</focalLength>
        <hackBaseline>0</hackBaseline>
      </plugin>
    </sensor>
  </gazebo>

<!-- wheel -->
  <gazebo>
    <plugin name="mecanum_control" filename="libgazebo_ros_planar_move.so">
      <!-- <ros>
        <argument>odom:=odom</argument>
      </ros> -->
      <command_topic>cmd_vel</command_topic>
      <odometry_topic>odom</odometry_topic>
      <odometry_frame>odom</odometry_frame>
      <odometry_rate>30.0</odometry_rate>
      <robot_base_frame>base_link</robot_base_frame>
      <publish_odom>true</publish_odom>
      <publish_odom_tf>true</publish_odom_tf>
    </plugin>
  </gazebo>
  
<!-- imu -->
  <link name="imu_link">
    <visual>
      <geometry>
        <box size="0.03 0.03 0.01"/>
      </geometry>
      <material name="red" />
    </visual>
    <collision>
      <geometry>
        <box size="0.03 0.03 0.01"/>
      </geometry>
    </collision>
    <xacro:box_inertia m="0.1" w="0.1" d="0.1" h="0.1"/>
  </link>
  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <origin xyz="0 0 0.005"/>
  </joint>

  <gazebo reference="imu_link">
    <gravity>true</gravity>
    <sensor name="twr_imu" type="imu">
      <always_on>true</always_on>
      <update_rate>20</update_rate>
      <visualize>true</visualize>
      <imu>
        <orientation>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-3</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-3</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-3</stddev>
            </noise>
          </z>
        </orientation>
        <angular_velocity>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </z>
        </angular_velocity>
        <linear_acceleration>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </z>
        </linear_acceleration>
      </imu>
      <plugin name="robot_imu" filename="libgazebo_ros_imu_sensor.so">
        <initial_orientation_as_reference>false</initial_orientation_as_reference>
        <frame_name>imu_link</frame_name>
        <ros>
          <namespace>/imu</namespace>
          <!-- <remapping>~/out:=data</remapping> -->
        </ros>
      </plugin>
    </sensor>
  </gazebo>

<!-- lidar -->
  <link name="lidar_link">
    <inertial>
      <origin xyz="-0.0065667270737461 0.000969221914658544 -0.00888016805798139" rpy="0 0 0" />
      <mass value="0.142994095653188" />
      <inertia
        ixx="4.62767161181518E-05"
        ixy="-8.53572518984292E-07"
        ixz="-3.62184026396734E-06"
        iyy="7.34746440088868E-05"
        iyz="2.04304178805859E-07"
        izz="0.000107960183716792" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/RPLidar_link.STL" />
      </geometry>
      <material name="grey" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://iron_x/meshes/RPLidar_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="lidar_joint" type="fixed">
    <origin xyz="0.0374418238801547 -0.00146432701544818 0.0799184773695659" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="lidar_link" />
    <axis xyz="0 0 1" />
  </joint>

  <gazebo reference="lidar_link">
    <material>Gazebo/Gray</material>
  </gazebo>

  <gazebo reference="lidar_link">
    <sensor name="lidar" type="ray">
      <always_on>true</always_on>
      <visualize>true</visualize>
      <update_rate>20</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1.000000</resolution>
            <min_angle>0.000000</min_angle>
            <max_angle>6.280000</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.15</min>
          <max>12.0</max>
          <resolution>0.015000</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="scan" filename="libgazebo_ros_ray_sensor.so">
        <ros>
          <remapping>~/out:=scan</remapping>
        </ros>
        <output_type>sensor_msgs/LaserScan</output_type>
        <frame_name>lidar_link</frame_name>
      </plugin>
    </sensor>
  </gazebo>
  
</robot>